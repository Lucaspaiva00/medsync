generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

/**
 * ===========================================================
 * USUÁRIOS
 * ===========================================================
 */
model Usuario {
  id            Int           @id @default(autoincrement())
  nome          String
  email         String        @unique
  senha         String
  tipo          TipoUsuario
  identificacao String? // CRM ou Matrícula
  documentoUrl  String?
  status        StatusUsuario @default(PENDENTE)
  telefone      String?       @db.VarChar(20)
  instituicao   String?
  periodo       String?

  criadoEm     DateTime @default(now())
  atualizadoEm DateTime @updatedAt

  // Relacionamentos
  consultas  Consulta[]
  relatorios Relatorio[]
  documentos Documento[]
  notas      Nota[]
}

/**
 * ===========================================================
 * NOTAS
 * ===========================================================
 */
model Nota {
  id       Int    @id @default(autoincrement())
  titulo   String
  conteudo String @db.Text

  pasta       PastaNota? // "GERAL", "SELECIONADO", etc.
  favorito    Boolean    @default(false)
  selecionado Boolean    @default(false)

  tipo         TipoNota @default(NORMAL)
  criadoEm     DateTime @default(now())
  atualizadoEm DateTime @updatedAt

  ultimoUsoEm DateTime @default(now())

  // Relação com o usuário
  usuarioId Int
  usuario   Usuario @relation(fields: [usuarioId], references: [id])

  // Relação com template (se for um template inteligente)
  templateId Int?
  template   Template? @relation(fields: [templateId], references: [id])

  @@index([usuarioId])
  @@index([favorito])
  @@index([selecionado])
  @@index([pasta])
}

/**
 * ===========================================================
 * TEMPLATES (NOTAS INTELIGENTES)
 * ===========================================================
 */
model Template {
  id        Int     @id @default(autoincrement())
  nome      String
  descricao String?
  conteudo  String  @db.Text

  criadoEm     DateTime @default(now())
  atualizadoEm DateTime @updatedAt

  notas Nota[]
}

/**
 * ===========================================================
 * PACIENTES
 * ===========================================================
 */
model Paciente {
  id       Int      @id @default(autoincrement())
  nome     String
  cpf      String?  @unique
  email    String?
  telefone String?
  status   String?
  criadoEm DateTime @default(now())

  consultas  Consulta[]
  relatorios Relatorio[]
}

/**
 * ===========================================================
 * CONSULTAS
 * ===========================================================
 */
model Consulta {
  id          Int      @id @default(autoincrement())
  data        DateTime
  hora        String
  status      String   @default("PENDENTE")
  observacoes String?
  criadoEm    DateTime @default(now())

  pacienteId Int
  paciente   Paciente @relation(fields: [pacienteId], references: [id])

  usuarioId Int
  usuario   Usuario @relation(fields: [usuarioId], references: [id])
}

/**
 * ===========================================================
 * RELATÓRIOS MÉDICOS
 * ===========================================================
 */
model Relatorio {
  id       Int      @id @default(autoincrement())
  laudo    String   @db.Text
  criadoEm DateTime @default(now())

  usuarioId Int
  usuario   Usuario @relation(fields: [usuarioId], references: [id])

  pacienteId Int
  paciente   Paciente @relation(fields: [pacienteId], references: [id])

  medicamentos MedicamentoPrescrito[]
}

/**
 * ===========================================================
 * MEDICAMENTOS
 * ===========================================================
 */
model Medicamento {
  id         Int      @id @default(autoincrement())
  nome       String
  descricao  String?
  dosePadrao String?
  criadoEm   DateTime @default(now())

  medicamentosPrescritos MedicamentoPrescrito[]
}

/**
 * ===========================================================
 * MEDICAMENTOS PRESCRITOS
 * ===========================================================
 */
model MedicamentoPrescrito {
  id       Int    @id @default(autoincrement())
  nome     String
  dose     String
  horarios String

  relatorioId Int
  relatorio   Relatorio @relation(fields: [relatorioId], references: [id])

  medicamentoId Int?
  medicamento   Medicamento? @relation(fields: [medicamentoId], references: [id])
}

/**
 * ===========================================================
 * DOCUMENTOS DE VALIDAÇÃO
 * ===========================================================
 */
model Documento {
  id        Int      @id @default(autoincrement())
  usuarioId Int
  usuario   Usuario  @relation(fields: [usuarioId], references: [id])
  tipo      String
  url       String
  status    String   @default("EM_ANALISE")
  enviadoEm DateTime @default(now())
}

/**
 * ===========================================================
 * ENUMS
 * ===========================================================
 */
enum TipoUsuario {
  MEDICO
  ACADEMICO
  ADMIN
}

enum StatusUsuario {
  PENDENTE
  VERIFICADO
  RECUSADO
}

enum TipoNota {
  NORMAL
  TEMPLATE
}

enum PastaNota {
  GERAL
  MINHAS
  FAVORITOS
  SELECIONADO
  RECENTES
  TEMPLATES
}
