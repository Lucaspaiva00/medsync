generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id            Int           @id @default(autoincrement())
  nome          String
  email         String        @unique
  senha         String
  tipo          TipoUsuario // "MEDICO" | "ACADEMICO" | "ADMIN"
  identificacao String? // CRM ou Matrícula
  documentoUrl  String? // arquivo enviado
  status        StatusUsuario @default(PENDENTE)
  telefone      String?       @db.VarChar(20)
  instituicao   String? // Universidade ou Hospital
  periodo       String? // Ex: "8º período" (acadêmico)
  criadoEm      DateTime      @default(now())
  atualizadoEm  DateTime      @updatedAt

  // Relacionamentos
  consultas  Consulta[]
  relatorios Relatorio[]
  documentos Documento[]
}

model Paciente {
  id       Int      @id @default(autoincrement())
  nome     String
  cpf      String?  @unique
  email    String?
  telefone String?
  status   String? // Ex: Estável, Atenção, Crítico
  criadoEm DateTime @default(now())

  // Relacionamentos
  consultas  Consulta[]
  relatorios Relatorio[]
}

model Consulta {
  id          Int      @id @default(autoincrement())
  data        DateTime
  hora        String
  status      String   @default("PENDENTE")
  observacoes String?
  criadoEm    DateTime @default(now())

  // Relacionamentos
  pacienteId Int
  paciente   Paciente @relation(fields: [pacienteId], references: [id])

  usuarioId Int // Médico responsável
  usuario   Usuario @relation(fields: [usuarioId], references: [id])
}

model Relatorio {
  id       Int      @id @default(autoincrement())
  laudo    String   @db.Text
  criadoEm DateTime @default(now())

  usuarioId Int
  usuario   Usuario @relation(fields: [usuarioId], references: [id])

  pacienteId Int
  paciente   Paciente @relation(fields: [pacienteId], references: [id])

  medicamentos MedicamentoPrescrito[]
}

model Medicamento {
  id         Int      @id @default(autoincrement())
  nome       String
  descricao  String?
  dosePadrao String? // ex: "500mg"
  criadoEm   DateTime @default(now())

  medicamentosPrescritos MedicamentoPrescrito[]
}

model MedicamentoPrescrito {
  id            Int          @id @default(autoincrement())
  nome          String
  dose          String
  horarios      String
  relatorioId   Int
  relatorio     Relatorio    @relation(fields: [relatorioId], references: [id])
  medicamento   Medicamento? @relation(fields: [medicamentoId], references: [id])
  medicamentoId Int?
}

model Documento {
  id        Int      @id @default(autoincrement())
  usuarioId Int
  usuario   Usuario  @relation(fields: [usuarioId], references: [id])
  tipo      String // Ex: "Comprovante de Matrícula", "CRM"
  url       String
  status    String   @default("EM_ANALISE")
  enviadoEm DateTime @default(now())
}

enum TipoUsuario {
  MEDICO
  ACADEMICO
  ADMIN
}

enum StatusUsuario {
  PENDENTE
  VERIFICADO
  RECUSADO
}
